<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üéÆ –ò–≥—Ä–æ–≤–æ–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
<div style="max-width: 600px; margin: 0 auto 30px auto; text-align: center;">
    <h2>üîç –ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>
    <form id="search-form">
        <div style="margin-bottom: 10px;">
            <input type="text" id="search-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" style="width: 80%; padding: 10px;">
        </div>
        <div style="margin-bottom: 10px;">
            <input type="text" id="search-game" placeholder="–ò–≥—Ä–∞" style="width: 80%; padding: 10px;">
        </div>
        <div style="margin-bottom: 10px;">
            <select id="search-type" style="width: 80%; padding: 10px;">
                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                <option value="sale">–¢–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∂–∏</option>
                <option value="exchange">–¢–æ–ª—å–∫–æ –æ–±–º–µ–Ω—ã</option>
            </select>
        </div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
            <input type="number" id="price-min" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" step="any" style="width: 40%; padding: 10px;">
            <input type="number" id="price-max" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" step="any" style="width: 40%; padding: 10px;">
        </div>
        <button type="submit" style="padding: 10px 20px;">–ü–æ–∏—Å–∫</button>
        <button type="button" id="reset-btn" style="margin-left: 10px; padding: 10px 20px; background-color: #6c757d;">–°–±—Ä–æ—Å</button>
    </form>
</div>

        .listings-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .listing-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 300px;
            padding: 15px;
        }

        .listing-title {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .listing-game {
            color: #007bff;
            font-weight: bold;
        }

        .listing-price {
            color: green;
            margin-top: 10px;
        }

        .listing-exchange {
            color: orange;
            margin-top: 5px;
        }

        .listing-description {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>

<h1>üéÆ –û–±—ä—è–≤–ª–µ–Ω–∏—è –æ –ø—Ä–æ–¥–∞–∂–µ –∏ –æ–±–º–µ–Ω–µ</h1>

<div class="listings-container" id="listings">
    <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
</div>

<script>
    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å API
    fetch('http://127.0.0.1:5000/listings')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('listings');

            if (data.length === 0) {
                container.innerHTML = "<p>–ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.</p>";
                return;
            }

            data.forEach(listing => {
                const card = document.createElement('div');
                card.className = 'listing-card';

                card.innerHTML = `
                    <div class="listing-title">${escapeHtml(listing.title)}</div>
                    <div class="listing-game">–ò–≥—Ä–∞: ${escapeHtml(listing.game)}</div>
                    <div class="listing-price">–¶–µ–Ω–∞: ${listing.price ? listing.price + ' —Ä—É–±.' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    <div class="listing-exchange">
                        ${listing.is_exchange ? '–í–æ–∑–º–æ–∂–µ–Ω –æ–±–º–µ–Ω –Ω–∞: ' + escapeHtml(listing.exchange_for || '–õ—é–±–æ–π –ø—Ä–µ–¥–º–µ—Ç') : '–ü—Ä–æ–¥–∞–∂–∞'}
                    </div>
                    <div class="listing-description">–û–ø–∏—Å–∞–Ω–∏–µ: ${escapeHtml(listing.description)}</div>
                `;

                container.appendChild(card);
            });
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', error);
            document.getElementById('listings').innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</p>";
        });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
    function escapeHtml(text) {
        return text.replace(/[&<>"']/g, function(m) { return {'&':'&amp;', '<':'<', '>':'>', '"':'&quot;', "'":'&#39;'}[m];});
    }

    function loadListings() {
    fetch('http://127.0.0.1:5000/listings')
        .then(response => response.json())
        .then(data => {
            const filtered = filterListings(data);
            const container = document.getElementById('listings');
            container.innerHTML = '';

            if (filtered.length === 0) {
                container.innerHTML = "<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>";
                return;
            }

            filtered.forEach(listing => {
                const card = document.createElement('div');
                card.className = 'listing-card';

                card.innerHTML = `
                    <div class="listing-title">${escapeHtml(listing.title)}</div>
                    <div class="listing-game">–ò–≥—Ä–∞: ${escapeHtml(listing.game)}</div>
                    <div class="listing-price">–¶–µ–Ω–∞: ${listing.price ? listing.price + ' —Ä—É–±.' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    <div class="listing-exchange">
                        ${listing.is_exchange ? '–í–æ–∑–º–æ–∂–µ–Ω –æ–±–º–µ–Ω –Ω–∞: ' + escapeHtml(listing.exchange_for || '–õ—é–±–æ–π –ø—Ä–µ–¥–º–µ—Ç') : '–ü—Ä–æ–¥–∞–∂–∞'}
                    </div>
                    <div class="listing-description">–û–ø–∏—Å–∞–Ω–∏–µ: ${escapeHtml(listing.description)}</div>
                `;

                container.appendChild(card);
            });
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', error);
            document.getElementById('listings').innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</p>";
        });
}

    // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
function filterListings(listings) {
    const titleFilter = document.getElementById('search-title').value.trim().toLowerCase();
    const gameFilter = document.getElementById('search-game').value.trim().toLowerCase();
    const typeFilter = document.getElementById('search-type').value;
    const priceMin = parseFloat(document.getElementById('price-min').value);
    const priceMax = parseFloat(document.getElementById('price-max').value);

    return listings.filter(listing => {
        const matchTitle = listing.title.toLowerCase().includes(titleFilter);
        const matchGame = listing.game.toLowerCase().includes(gameFilter);
        const matchType = typeFilter === '' || (typeFilter === 'sale' && !listing.is_exchange) || (typeFilter === 'exchange' && listing.is_exchange);
        const matchPrice = (!isNaN(priceMin) ? listing.price >= priceMin : true) &&
                           (!isNaN(priceMax) ? listing.price <= priceMax : true);
        return matchTitle && matchGame && matchType && matchPrice;
    });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –ø–æ–∏—Å–∫–∞
document.getElementById('search-form').addEventListener('submit', function(e) {
    e.preventDefault();
    loadListings();
});

document.getElementById('reset-btn').addEventListener('click', function() {
    document.getElementById('search-form').reset();
    loadListings();
});

    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
loadListings();
</script>

</body>
</html>